<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.gd.sakila.mapper.FilmMapper">

	<!-- Map : filmId(in), storeId(in), filmCount(out) -->
	<select id="selectFilmInStock" parameterType="java.util.Map" resultType="int" statementType="CALLABLE">
		{
			call film_in_stock(
				#{filmId},
				#{storeId},
				#{filmCount, mode=OUT, jdbcType=DECIMAL, javaType=Integer}
			)
		}
	</select>
	
	<select id="selectRatingList" resultType="String">
		SELECT
			DISTINCT rating
		FROM film
	</select>
	
	<select id="selectFilmList" parameterType="java.util.Map" resultType="java.util.Map">
		SELECT
			FID FID,
			title title,
			category category,
			price price,
			rating rating,
			actors actors
		FROM film_list
		<where>
			<if test="categoryName != null">
				AND category = #{categoryName}
			</if>
			<if test="price != null">
				AND price = #{price}
			</if>
			<if test="rating != null">
				AND rating = #{rating}
			</if>
			<if test="title != null"> 
				AND title LIKE CONCAT('%',#{title},'%')
			</if>
			<if test="actor != null"> 
				AND actors LIKE CONCAT('%',#{actor},'%')
			</if>
		</where>
		LIMIT #{beginRow}, #{rowPerPage}
	</select>
	
	<select id="selectFilmTotal" resultType="int" parameterType="java.util.Map">
		SELECT count(*) FROM film_list
		<where>
			<if test="categoryName != null">
				AND category = #{categoryName}
			</if>
			<if test="price != null">
				AND price = #{price}
			</if>
			<if test="rating != null">
				AND rating = #{rating}
			</if>
			<if test="title != null"> 
				AND title LIKE CONCAT('%',#{title},'%')
			</if>
			<if test="actor != null"> 
				AND actors LIKE CONCAT('%',#{actor},'%')
			</if>
		</where>
	</select>
	
	<select id="selectFilmOne" parameterType="int" resultType="com.gd.sakila.vo.Film">
		SELECT 
			film_id filmId, 
			title title, 
			description description, 
			release_year releaseYear, 
			language_id languageId, 
			original_language_id originalLanguageId, 
			rental_duration rentalDuration, 
			rental_rate rentalRate, 
			length length, 
			replacement_cost replacementCost, 
			rating rating, 
			special_features specialFeatures, 
			last_update lastUpdate 
		FROM film WHERE film_id = #{val}
	</select>
</mapper>
